// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  role         Role
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  studentProfile       StudentProfile?
  mentorProfile        MentorProfile?
  internships          Internship[]
  mentorAvailabilities MentorAvailability[]
  studentBookings      Booking[]            @relation("StudentBookings")
  mentorBookings       Booking[]            @relation("MentorBookings")
}

model StudentProfile {
  id             String   @id @default(uuid())
  userId         String   @unique
  fullName       String?
  university     String?
  program        String?
  graduationYear Int?
  bio            String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MentorProfile {
  id          String   @id @default(uuid())
  userId      String   @unique
  fullName    String?
  bio         String?
  expertise   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Internship {
  id              String           @id @default(uuid())
  studentId       String
  company         String
  roleTitle       String
  status          InternshipStatus @default(APPLIED)
  applicationLink String?
  notes           String?
  appliedAt       DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  student User @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([status])
}

model MentorAvailability {
  id        String   @id @default(uuid())
  mentorId  String
  startTime DateTime
  endTime   DateTime
  isBooked  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  mentor   User      @relation(fields: [mentorId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@index([mentorId, startTime])
}

model Booking {
  id             String        @id @default(uuid())
  studentId      String
  mentorId       String
  availabilityId String
  status         BookingStatus @default(PENDING)
  note           String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  student      User               @relation("StudentBookings", fields: [studentId], references: [id], onDelete: Cascade)
  mentor       User               @relation("MentorBookings", fields: [mentorId], references: [id], onDelete: Cascade)
  availability MentorAvailability @relation(fields: [availabilityId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([mentorId])
  @@index([availabilityId])
}

enum Role {
  STUDENT
  MENTOR
  ADMIN
}

enum InternshipStatus {
  APPLIED
  ACTIVE
  COMPLETED
}

enum BookingStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELLED
}
